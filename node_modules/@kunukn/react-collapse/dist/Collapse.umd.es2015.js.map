{"version":3,"file":"Collapse.umd.es2015.js","sources":["../src/components/collapse/Collapse.class.jsx"],"sourcesContent":["import \"./collapse.css\";\nimport React from \"react\";\nimport debugLog from \"./debugLog\";\n\nconst COLLAPSED = \"collapsed\";\nconst COLLAPSING = \"collapsing\";\nconst EXPANDING = \"expanding\";\nconst EXPANDED = \"expanded\";\n\nexport default class Collapse extends React.Component {\n  static defaultProps = {\n    style: {}\n  };\n  state = {\n    collapseState: this.props.isOpen ? EXPANDED : COLLAPSED,\n    collapseStyle: {\n      height: this.props.isOpen ? null : getCollapseHeight(this.props),\n      visibility: this.props.isOpen ? null : getCollapseVisibility(this.props)\n    }\n  };\n\n  render() {\n    const {\n      className,\n      addState,\n      children,\n      transition,\n      style,\n      render,\n      elementType,\n      noAnim,\n      overflowOnExpanded,\n      collapseHeight, // exclude from ...rest\n      onInit,\n      onChange,\n      isOpen,\n      ...rest\n    } = this.props;\n\n    let overflow =\n      this.state.collapseState === EXPANDED && overflowOnExpanded\n        ? \"\"\n        : \"hidden\";\n\n    let computedStyle = {\n      overflow,\n      transition\n      //...style,\n      //...this.state.collapseStyle\n    };\n    Object.assign(computedStyle, style);\n    Object.assign(computedStyle, this.state.collapseStyle);\n\n    const ElementType = elementType || \"div\";\n    let collapseClassName = addState\n      ? `${className} --c-${this.state.collapseState}`\n      : className;\n\n    return (\n      <ElementType\n        ref={element => {\n          this.content = element;\n        }}\n        style={computedStyle}\n        className={collapseClassName}\n        onTransitionEnd={this.onTransitionEnd}\n        {...rest}\n      >\n        {typeof children === \"function\"\n          ? children(this.state.collapseState)\n          : typeof render === \"function\"\n          ? render(this.state.collapseState)\n          : children}\n      </ElementType>\n    );\n  }\n\n  // Detect a new collapse state from props.isOpen change\n  static getDerivedStateFromProps(props, state) {\n    const isOpen =\n      state.collapseState === EXPANDED || state.collapseState === EXPANDING;\n\n    if (!isOpen && props.isOpen) {\n      return {\n        collapseState: props.noAnim ? EXPANDED : EXPANDING\n      };\n    }\n    if (isOpen && !props.isOpen) {\n      return {\n        collapseState: props.noAnim ? COLLAPSED : COLLAPSING\n      };\n    }\n\n    return null;\n  }\n\n  componentDidMount() {\n    this.onCallback(this.props.onInit);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (!this.content) return;\n\n    if (this.state.collapseState === prevState.collapseState) return;\n\n    switch (this.state.collapseState) {\n      case EXPANDING:\n        this.setExpanding();\n        break;\n      case COLLAPSING:\n        this.setCollapsing();\n        break;\n      case EXPANDED:\n        this.setExpanded();\n        break;\n      case COLLAPSED:\n        this.setCollapsed();\n        break;\n      // no default\n    }\n  }\n\n  onTransitionEnd = ({ target, propertyName }) => {\n    if (target === this.content && propertyName === \"height\") {\n      debugLog(\n        \"onTransitionEnd\",\n        this.state.collapseState,\n        propertyName,\n        target.style.height\n      );\n\n      switch (this.state.collapseState) {\n        case EXPANDING:\n          if (target.style.height === \"0px\")\n            // This is stale, a newer event has happened before this could execute\n            debugLog(\n              \"onTransitionEnd height unexpected 0px\",\n              \"ignore setExpanded\"\n            );\n          else this.setState({ collapseState: EXPANDED });\n          break;\n        case COLLAPSING:\n          if (target.style.height !== \"0px\")\n            // This is stale, a newer event has happened before this could execute\n            debugLog(\n              `onTransitionEnd height unexpected ${target.style.height}`,\n              \"ignore setCollapsed\"\n            );\n          else this.setState({ collapseState: COLLAPSED });\n          break;\n        default:\n          debugLog(\"Ignored in onTransitionEnd\", this.state.collapseState);\n      }\n    }\n  };\n\n  getHeight = () => `${this.content.scrollHeight}px`;\n\n  onCallback = callback => {\n    callback &&\n      callback({\n        ...this.state,\n        isMoving: isMoving(this.state.collapseState)\n      });\n  };\n\n  setCollapsed = () => {\n    if (!this.content) return;\n\n    this.setState(\n      {\n        collapseStyle: {\n          height: getCollapseHeight(this.props),\n          visibility: getCollapseVisibility(this.props)\n        }\n      },\n      () => this.onCallback(this.props.onChange)\n    );\n  };\n\n  setCollapsing = () => {\n    if (!this.content) return;\n\n    const height = this.getHeight();\n\n    this.setState({\n      collapseStyle: {\n        height,\n        visibility: \"\"\n      }\n    });\n\n    nextFrame(() => {\n      this.setState(\n        {\n          collapseStyle: {\n            height: getCollapseHeight(this.props),\n            visibility: \"\"\n          }\n        },\n        () => this.onCallback(this.props.onChange)\n      );\n    });\n  };\n\n  setExpanding = () => {\n    nextFrame(() => {\n      if (this.content) {\n        const height = this.getHeight();\n\n        this.setState(\n          {\n            collapseStyle: {\n              height,\n              visibility: \"\"\n            }\n          },\n          () => this.onCallback(this.props.onChange)\n        );\n      }\n    });\n  };\n\n  setExpanded = () => {\n    if (!this.content) return;\n\n    this.setState(\n      {\n        collapseStyle: {\n          height: \"\",\n          visibility: \"\"\n        }\n      },\n      () => this.onCallback(this.props.onChange)\n    );\n  };\n}\n\nfunction nextFrame(callback) {\n  requestAnimationFrame(() => requestAnimationFrame(callback));\n}\n\nfunction isMoving(collapseState) {\n  return collapseState === EXPANDING || collapseState === COLLAPSING;\n}\n\nfunction getCollapseHeight(props) {\n  return props.collapseHeight || \"0px\";\n}\n\nfunction getCollapseVisibility(props) {\n  return props.collapseHeight ? \"\" : \"hidden\";\n}\n"],"names":["COLLAPSED","COLLAPSING","EXPANDING","EXPANDED","Collapse","React","Component","collapseState","this","props","isOpen","collapseStyle","height","getCollapseHeight","visibility","getCollapseVisibility","target","propertyName","content","state","style","setState","scrollHeight","callback","isMoving","onCallback","onChange","getHeight","nextFrame","render","className","addState","children","transition","elementType","noAnim","overflowOnExpanded","collapseHeight","onInit","rest","computedStyle","overflow","Object","assign","ElementType","collapseClassName","ref","element","onTransitionEnd","componentDidMount","componentDidUpdate","prevProps","prevState","setExpanding","setCollapsing","setExpanded","setCollapsed","requestAnimationFrame"],"mappings":"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"}