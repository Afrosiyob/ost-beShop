{"version":3,"file":"Collapse.umd.js","sources":["../src/components/collapse/Collapse.class.jsx"],"sourcesContent":["import \"./collapse.css\";\nimport React from \"react\";\nimport debugLog from \"./debugLog\";\n\nconst COLLAPSED = \"collapsed\";\nconst COLLAPSING = \"collapsing\";\nconst EXPANDING = \"expanding\";\nconst EXPANDED = \"expanded\";\n\nexport default class Collapse extends React.Component {\n  static defaultProps = {\n    style: {}\n  };\n  state = {\n    collapseState: this.props.isOpen ? EXPANDED : COLLAPSED,\n    collapseStyle: {\n      height: this.props.isOpen ? null : getCollapseHeight(this.props),\n      visibility: this.props.isOpen ? null : getCollapseVisibility(this.props)\n    }\n  };\n\n  render() {\n    const {\n      className,\n      addState,\n      children,\n      transition,\n      style,\n      render,\n      elementType,\n      noAnim,\n      overflowOnExpanded,\n      collapseHeight, // exclude from ...rest\n      onInit,\n      onChange,\n      isOpen,\n      ...rest\n    } = this.props;\n\n    let overflow =\n      this.state.collapseState === EXPANDED && overflowOnExpanded\n        ? \"\"\n        : \"hidden\";\n\n    let computedStyle = {\n      overflow,\n      transition\n      //...style,\n      //...this.state.collapseStyle\n    };\n    Object.assign(computedStyle, style);\n    Object.assign(computedStyle, this.state.collapseStyle);\n\n    const ElementType = elementType || \"div\";\n    let collapseClassName = addState\n      ? `${className} --c-${this.state.collapseState}`\n      : className;\n\n    return (\n      <ElementType\n        ref={element => {\n          this.content = element;\n        }}\n        style={computedStyle}\n        className={collapseClassName}\n        onTransitionEnd={this.onTransitionEnd}\n        {...rest}\n      >\n        {typeof children === \"function\"\n          ? children(this.state.collapseState)\n          : typeof render === \"function\"\n          ? render(this.state.collapseState)\n          : children}\n      </ElementType>\n    );\n  }\n\n  // Detect a new collapse state from props.isOpen change\n  static getDerivedStateFromProps(props, state) {\n    const isOpen =\n      state.collapseState === EXPANDED || state.collapseState === EXPANDING;\n\n    if (!isOpen && props.isOpen) {\n      return {\n        collapseState: props.noAnim ? EXPANDED : EXPANDING\n      };\n    }\n    if (isOpen && !props.isOpen) {\n      return {\n        collapseState: props.noAnim ? COLLAPSED : COLLAPSING\n      };\n    }\n\n    return null;\n  }\n\n  componentDidMount() {\n    this.onCallback(this.props.onInit);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (!this.content) return;\n\n    if (this.state.collapseState === prevState.collapseState) return;\n\n    switch (this.state.collapseState) {\n      case EXPANDING:\n        this.setExpanding();\n        break;\n      case COLLAPSING:\n        this.setCollapsing();\n        break;\n      case EXPANDED:\n        this.setExpanded();\n        break;\n      case COLLAPSED:\n        this.setCollapsed();\n        break;\n      // no default\n    }\n  }\n\n  onTransitionEnd = ({ target, propertyName }) => {\n    if (target === this.content && propertyName === \"height\") {\n      debugLog(\n        \"onTransitionEnd\",\n        this.state.collapseState,\n        propertyName,\n        target.style.height\n      );\n\n      switch (this.state.collapseState) {\n        case EXPANDING:\n          if (target.style.height === \"0px\")\n            // This is stale, a newer event has happened before this could execute\n            debugLog(\n              \"onTransitionEnd height unexpected 0px\",\n              \"ignore setExpanded\"\n            );\n          else this.setState({ collapseState: EXPANDED });\n          break;\n        case COLLAPSING:\n          if (target.style.height !== \"0px\")\n            // This is stale, a newer event has happened before this could execute\n            debugLog(\n              `onTransitionEnd height unexpected ${target.style.height}`,\n              \"ignore setCollapsed\"\n            );\n          else this.setState({ collapseState: COLLAPSED });\n          break;\n        default:\n          debugLog(\"Ignored in onTransitionEnd\", this.state.collapseState);\n      }\n    }\n  };\n\n  getHeight = () => `${this.content.scrollHeight}px`;\n\n  onCallback = callback => {\n    callback &&\n      callback({\n        ...this.state,\n        isMoving: isMoving(this.state.collapseState)\n      });\n  };\n\n  setCollapsed = () => {\n    if (!this.content) return;\n\n    this.setState(\n      {\n        collapseStyle: {\n          height: getCollapseHeight(this.props),\n          visibility: getCollapseVisibility(this.props)\n        }\n      },\n      () => this.onCallback(this.props.onChange)\n    );\n  };\n\n  setCollapsing = () => {\n    if (!this.content) return;\n\n    const height = this.getHeight();\n\n    this.setState({\n      collapseStyle: {\n        height,\n        visibility: \"\"\n      }\n    });\n\n    nextFrame(() => {\n      this.setState(\n        {\n          collapseStyle: {\n            height: getCollapseHeight(this.props),\n            visibility: \"\"\n          }\n        },\n        () => this.onCallback(this.props.onChange)\n      );\n    });\n  };\n\n  setExpanding = () => {\n    nextFrame(() => {\n      if (this.content) {\n        const height = this.getHeight();\n\n        this.setState(\n          {\n            collapseStyle: {\n              height,\n              visibility: \"\"\n            }\n          },\n          () => this.onCallback(this.props.onChange)\n        );\n      }\n    });\n  };\n\n  setExpanded = () => {\n    if (!this.content) return;\n\n    this.setState(\n      {\n        collapseStyle: {\n          height: \"\",\n          visibility: \"\"\n        }\n      },\n      () => this.onCallback(this.props.onChange)\n    );\n  };\n}\n\nfunction nextFrame(callback) {\n  requestAnimationFrame(() => requestAnimationFrame(callback));\n}\n\nfunction isMoving(collapseState) {\n  return collapseState === EXPANDING || collapseState === COLLAPSING;\n}\n\nfunction getCollapseHeight(props) {\n  return props.collapseHeight || \"0px\";\n}\n\nfunction getCollapseVisibility(props) {\n  return props.collapseHeight ? \"\" : \"hidden\";\n}\n"],"names":["COLLAPSED","COLLAPSING","EXPANDING","EXPANDED","Collapse","collapseState","_this","props","isOpen","collapseStyle","height","getCollapseHeight","visibility","getCollapseVisibility","target","propertyName","content","state","style","setState","scrollHeight","callback","isMoving","onCallback","onChange","getHeight","nextFrame","React","Component","noAnim","this","className","addState","children","transition","render","elementType","overflowOnExpanded","rest","collapseHeight","onInit","computedStyle","overflow","Object","assign","ElementType","collapseClassName","ref","element","_this2","onTransitionEnd","prevProps","prevState","setExpanding","setCollapsing","setExpanded","setCollapsed","requestAnimationFrame"],"mappings":"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"}